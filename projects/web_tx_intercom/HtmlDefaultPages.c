#include <stdio.h>
#include <string.h>
#include "pico/stdlib.h"
#include "HtmlDefaultPages.h"


const char * FAVICON_HEADER =   "HTTP/1.1 200 OK\r\n"
                                "Content-Type: image/x-icon\r\n"
                                "Content-Length: %d\r\n"
                                "Connection: close\r\n\r\n";

//$ cat IconItx.ico | hexdump -C -v
const uint8_t FAVICON_ICON[] = {
    0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x10, 0x10, 0x02, 0x00, 0x01, 0x00, 0x01, 0x00, 0xb0, 0x00,
    0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x20, 0x00,
    0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0xff, 0xff, 0x00, 0x00, 0x82, 0xdd, 0x00, 0x00, 0xee, 0xeb,
    0x00, 0x00, 0xee, 0xf7, 0x00, 0x00, 0xee, 0xeb, 0x00, 0x00, 0xee, 0xdd, 0x00, 0x00, 0xee, 0xff,
    0x00, 0x00, 0xee, 0xff, 0x00, 0x00, 0xe8, 0x3f, 0x00, 0x00, 0xef, 0xff, 0x00, 0x00, 0xef, 0xff,
    0x00, 0x00, 0xef, 0xff, 0x00, 0x00, 0xef, 0xff, 0x00, 0x00, 0xef, 0xff, 0x00, 0x00, 0x83, 0xff,
    0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

// Retorna um string com um HTML de uma página de erro, 404
char * htlm_error_page(){
    return  "HTTP/1.1 404 Not Found\r\n"
            "Content-Length: 0\r\n"
            "Connection: close\r\n\r\n";
}

// Coloca no buffer um Html com um icone vazio, tamanho zero
// Retorna o número de bytes que foram colocados no buffer
uint32_t htlm_favicon_null(char *buffer, uint32_t buffer_size){
    const char * ret = 
      "HTTP/1.1 200 OK\r\n"
      "Content-Type: image/x-icon\r\n"
      "Content-Length: 0\r\n"
      "Connection: close\r\n\r\n";

    uint32_t length = strlen(ret);
    strncpy(buffer, ret, buffer_size);
    return length;
}

// Coloca no buffer um Html com um icone utilizado neste sistema
// Retorna o número de bytes que foram colocados no buffer
uint32_t htlm_favicon_page(char *buffer, uint32_t buffer_size){
    // não está sendo usado buffer size
    // 16x16 ou 32x32
    uint32_t next = sprintf(buffer, FAVICON_HEADER, sizeof(FAVICON_ICON));  // Informa o tamanho do icone que será adicionado
    memcpy(&(buffer[next]), FAVICON_ICON, sizeof(FAVICON_ICON));
    return next + sizeof(FAVICON_ICON);
}